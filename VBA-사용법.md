# 📊 재무 리포트 대시보드 VBA 연동 가이드

## 🚀 개요
이 VBA 코드는 엑셀에서 웹 대시보드의 API와 연동하여 재무 리포트의 승인/반려 처리를 할 수 있게 해줍니다.

## 📋 사전 준비사항

### 1. 엑셀 설정
- **Microsoft Excel 2016 이상** 권장
- **VBA 매크로 사용 허용** 설정 필요
- **파일 > 옵션 > 보안 센터 > 매크로 설정**에서 "VBA 매크로 사용"으로 설정

### 2. 개발 서버 실행
```bash
pnpm dev
```
- 대시보드 서버가 `http://localhost:3001`에서 실행 중이어야 함

## 🛠 설치 및 설정

### 1단계: VBA 코드 추가
1. 엑셀 파일을 열고 `Alt + F11`을 눌러 VBA 편집기 열기
2. **삽입 > 모듈**을 선택하여 새 모듈 생성
3. 제공된 VBA 코드를 모듈에 복사 붙여넣기
4. `Ctrl + S`로 저장 (매크로 포함 통합 문서로 저장)

### 2단계: 초기 설정
1. VBA 편집기에서 `버튼설정` 매크로 실행 (F5)
2. 워크시트에 버튼과 라벨이 자동으로 생성됨

### 3단계: API 연결 테스트
1. `API연결테스트` 매크로 실행하여 서버 연결 확인
2. 성공 메시지가 나타나면 설정 완료

## 🎯 사용법

### 워크시트 구성
```
A1: 년도:     B1: [2024]
A2: 월:       B2: [3]
A3: 승인상태: D2: [승인대기] (자동 업데이트)

[승인] [반려] [새로고침] 버튼
```

### 주요 기능

#### 1. 🟢 승인 처리
- **승인 버튼** 클릭
- 메모 입력 (선택사항)
- 확인 시 API로 승인 처리 전송
- 성공 시 대시보드에서 상태 즉시 반영

#### 2. 🔴 반려 처리  
- **반려 버튼** 클릭
- 반려 사유 입력 (필수)
- 확인 시 API로 반려 처리 전송

#### 3. 🔄 상태 새로고침
- **새로고침 버튼** 클릭
- 서버에서 최신 승인 상태 조회
- D2 셀에 색상과 함께 상태 표시

#### 4. 🔧 자동 기능
- 워크북 열릴 때 자동으로 상태 새로고침
- 년도/월 변경 시 해당 월의 데이터 조회

## 📱 상태 표시

| 상태 | 색상 | 설명 |
|------|------|------|
| 승인완료 | 🟢 연한 녹색 | 레포트가 승인됨 |
| 반려 | 🔴 연한 빨강 | 레포트가 반려됨 |
| 승인대기 | 🟡 연한 노랑 | 승인/반려 대기 중 |
| 확인불가 | ⚪ 회색 | 서버 연결 오류 |

## 🐛 문제 해결

### API 연결 실패 시
1. **서버 실행 확인**
   ```bash
   pnpm dev
   ```
2. **포트 번호 확인**: VBA 코드의 `API_BASE_URL` 수정 필요 시
3. **방화벽 설정**: localhost 접근 허용 확인

### VBA 오류 발생 시
1. **매크로 보안 설정** 확인
2. **Microsoft WinHTTP Services** 참조 라이브러리 확인
3. **네트워크 연결** 상태 점검

### 권한 오류 시
- Excel을 **관리자 권한**으로 실행
- **신뢰할 수 있는 위치**에 파일 저장

## 🔧 고급 설정

### API URL 변경
```vba
Private Const API_BASE_URL As String = "http://your-server:port/api"
```

### 셀 위치 변경
- `GetCurrentMonth()`, `GetCurrentYear()` 함수에서 셀 참조 수정
- `RefreshApprovalStatus()` 함수에서 상태 표시 셀 변경

## 🔄 API 엔드포인트

### 사용되는 API
- **GET** `/api/excel?month={월}&year={년}` - 승인 상태 조회
- **POST** `/api/excel` - 승인/반려 처리

### 요청 형식
```json
{
  "month": 3,
  "year": 2024,
  "approvalStatus": "approved|rejected",
  "memo": "승인/반려 메모",
  "approvedBy": "사용자명",
  "excelVersion": "Excel VBA v1.0"
}
```

## 📞 지원

### 매크로 목록
- `승인처리()` - 승인 버튼 이벤트
- `반려처리()` - 반려 버튼 이벤트  
- `상태새로고침()` - 새로고침 버튼 이벤트
- `버튼설정()` - 초기 UI 설정
- `API연결테스트()` - 연결 테스트

### 디버깅
- VBA 편집기에서 `F8`로 단계별 실행
- `Ctrl + G`로 직접 실행 창 열기
- 각 함수별로 개별 테스트 가능

---

💡 **팁**: 엑셀 파일을 `.xlsm` 확장자로 저장하여 매크로 기능을 유지하세요! 