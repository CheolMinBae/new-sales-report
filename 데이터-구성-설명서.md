# 재무 리포트 대시보드 데이터 구성 설명서

## 개요
본 문서는 엑셀 파일의 각 탭에서 어떤 데이터를 가져와서 웹 대시보드의 어떤 차트에 표시하는지를 상세히 설명합니다.

## 📋 엑셀 파일 구조 (시트 구성)

### 1번 시트: 재무리포트_대시보드 (VBA 컨트롤 패널)
- **역할**: VBA 매크로 실행 및 데이터 전송 제어
- **주요 요소**:
  - C3: 전송할 년도 입력
  - C4: 전송할 월 입력
  - 각종 VBA 실행 버튼들

### 2번 시트: 20~25년 정리표 (메인 데이터 소스)
- **역할**: 주요 재무 데이터 저장 및 분석
- **데이터 구조**:
  - A열: 년도 (예: "2024년")
  - B~M열: 1월~12월 데이터
  - 각 년도별로 다음 항목들이 행으로 구성:
    - 매출입금
    - 기타입금
    - 비용결제 (임대료, 인건비, 재료비, 운영비 포함)
    - 외상대

### 3번 시트: 통장 (거래 내역)
- **역할**: 실제 은행 거래 내역
- **사용 데이터**: 
  - 매출입금 거래
  - 월별 거래 합계

### 4번 시트: CASH FLOW (현금 흐름)
- **역할**: 현금 잔고 및 현금 흐름 데이터
- **사용 데이터**:
  - 현금잔고
  - 월별 현금 흐름 변동

## 🎯 VBA 데이터 수집 로직

### ReadFinanceDataFromCells() 함수
VBA에서 다음과 같이 각 시트에서 데이터를 수집합니다:

#### 1. 매출 수익 (salesRevenue)
```vba
' 소스: 2번 시트 (20~25년 정리표) + 3번 시트 (통장)
- 2번 시트에서 "매출입금" 행의 해당 월 데이터
- 3번 시트에서 "매출입금" 거래 합계
- 두 값을 합산하여 최종 매출 수익 계산
```

#### 2. 기타 수입 (otherIncome)
```vba
' 소스: 2번 시트 (20~25년 정리표)
- "기타입금" 행의 해당 월 데이터
```

#### 3. 각종 비용 항목들
```vba
' 소스: 2번 시트 (20~25년 정리표)
- 임대료 (rentExpense): "비용결제" 행에서 임대료 부분
- 인건비 (laborExpense): "비용결제" 행에서 인건비 부분  
- 재료비 (materialExpense): "비용결제" 행에서 재료비 부분
- 운영비 (operatingExpense): "비용결제" 행에서 운영비 부분
- 기타비용 (otherExpense): "외상대" 행의 해당 월 데이터
```

#### 4. 현금 잔고 (cashBalance)
```vba
' 소스: 4번 시트 (CASH FLOW) 또는 3번 시트 (통장)
- 1차 시도: 4번 시트에서 "현금잔고" 데이터
- 2차 시도: 3번 시트에서 마지막 잔액 데이터
```

## 📊 웹 대시보드 차트별 데이터 매핑

### 1. KPI 카드 (상단 지표)
| KPI 항목 | 데이터 소스 | 계산 방식 |
|---------|-----------|---------|
| 총 매출 | salesRevenue | 선택된 기간의 매출 합계 |
| 총 비용 | 모든 비용 항목 | rentExpense + laborExpense + materialExpense + operatingExpense + otherExpense |
| 순이익 | 계산값 | 총 매출 - 총 비용 |
| 현금 잔고 | cashBalance | 가장 최근 월의 현금 잔고 |

### 2. 매출 차트 (RevenueChart)
- **데이터**: salesRevenue + otherIncome
- **표시**: 월별 매출 추이 (선 그래프)
- **소스**: 2번, 3번 시트의 매출입금 + 기타입금

### 3. 비용 차트 (ExpenseChart)  
- **데이터**: 카테고리별 비용 구성
- **표시**: 
  - 임대료: rentExpense
  - 인건비: laborExpense  
  - 재료비: materialExpense
  - 운영비: operatingExpense
  - 기타비용: otherExpense
- **소스**: 2번 시트의 비용결제, 외상대 행

### 4. 월별 통계 차트 (MonthlyStatsChart)
- **데이터**: 월별 매출, 비용, 순이익
- **표시**: 막대 그래프 (월별 비교)
- **소스**: 모든 재무 데이터 종합

### 5. 수익 구조 차트 (ProfitStructureChart)
- **데이터**: 매출 대비 각 비용 항목 비율
- **표시**: 도넛 차트 (비용 구성 비율)
- **소스**: 2번 시트의 모든 비용 데이터

### 6. 현금 흐름 차트 (CashFlowChart)
- **데이터**: cashBalance, 월별 현금 흐름 변동
- **표시**: 영역 차트 (현금 잔고 변화)
- **소스**: 4번 시트 (CASH FLOW) 또는 3번 시트 (통장)

### 7. 고정비/유동비 게이지 (FixedVariableGauge)
- **데이터**: 
  - 고정비: rentExpense (임대료)
  - 유동비: laborExpense + materialExpense + operatingExpense
- **표시**: 원형 게이지 (비율 표시)
- **소스**: 2번 시트의 비용결제 데이터

### 8. 워터폴 차트 (WaterfallChart)
- **데이터**: 매출에서 각 비용을 차감하여 순이익까지의 흐름
- **표시**: 워터폴 형태 (매출 → 비용들 → 순이익)
- **소스**: 모든 재무 데이터 종합

### 9. 월별 상세 실적 테이블 (MonthlyDetailTable)
- **데이터**: 모든 재무 항목의 월별 상세 내역
- **표시**: 테이블 형태 (월별 상세 수치)
- **소스**: 전체 재무 데이터 종합

## 🔄 데이터 전송 프로세스

### 1. 단일 월 데이터 전송
1. VBA에서 C3, C4의 년도/월 읽기
2. ReadFinanceDataFromCells() 함수로 해당 월 데이터 수집
3. JSON 형태로 구성하여 `/api/reports/submit`에 POST 전송

### 2. 전체 년도 데이터 전송 (대용량)
1. VBA에서 2번 시트(20~25년 정리표) 전체 스캔
2. 2020년~2025년 모든 데이터 수집
3. 년도별/월별로 구조화하여 `/api/bulk-data/submit`에 POST 전송

## 📍 주요 데이터 위치 매핑

### 2번 시트 (20~25년 정리표) 구조 예시:
```
A열     B열     C열     D열     ...  M열
2024년   1월     2월     3월     ...  12월
매출입금  값1     값2     값3     ...  값12
기타입금  값1     값2     값3     ...  값12  
비용결제  값1     값2     값3     ...  값12
외상대   값1     값2     값3     ...  값12
```

### VBA 데이터 수집 순서:
1. **년도 행 찾기**: A열에서 "2024년" 검색
2. **월 열 계산**: 1월=B열(2), 2월=C열(3), ..., 12월=M열(13)
3. **항목 행 찾기**: 년도 행 다음 5행 범위에서 "매출입금", "기타입금" 등 검색
4. **데이터 추출**: 해당 행과 열이 교차하는 셀에서 값 읽기

## 💡 중요 참고사항

### 데이터 검증
- VBA에서 수집한 데이터는 실시간으로 웹 대시보드에 반영
- 승인/반려 상태는 `/api/excel` 엔드포인트를 통해 관리
- 데이터 무결성을 위해 각 월별로 승인 프로세스 진행

### 시트 명칭 변경 시 주의사항
- VBA 코드에서 시트를 찾는 순서: 이름 우선 → 순서 대안
- "20~25년 정리표" 시트명이 변경되면 VBA 코드 수정 필요
- 시트 순서가 변경되면 Worksheets(2), Worksheets(3) 등의 참조 수정 필요

### 성능 최적화
- 대용량 데이터 전송 시 30초 타임아웃 설정
- 검색 범위를 1000행 이내로 제한하여 성능 향상
- 병렬 데이터 수집으로 처리 속도 개선

---

본 문서는 2024년 12월 기준으로 작성되었으며, 시스템 업데이트에 따라 수정될 수 있습니다. 